{
  "name": "python-strava",
  "build": { "dockerfile": "Containerfile" },

  // Pass your Strava secrets from the host at runtime
  "containerEnv": {
    "STRAVA_CLIENT_ID": "${localEnv:STRAVA_CLIENT_ID}",
    "STRAVA_CLIENT_SECRET": "${localEnv:STRAVA_CLIENT_SECRET}",
    "STRAVA_REFRESH_TOKEN": "${localEnv:STRAVA_REFRESH_TOKEN}"
  },

  // Install / update Python packages after the first attach
  "postCreateCommand": "pip install --user -r requirements.txt",

  "runArgs": [
    // Allow ptrace so debugpy can attach
    "--cap-add=SYS_PTRACE",
    "--security-opt", "seccomp=unconfined"
  ],

  "customizations": {
    "vscode": {
      "extensions": [
        "ms-python.python",
        "ms-vscode-remote.remote-containers"
      ],
      "settings": {
        "python.defaultInterpreterPath": "/usr/local/bin/python",
        "python.analysis.typeCheckingMode": "basic"
      },
      "launch": {
        "configurations": [
          {
            "name": "Debug main.py",
            "type": "python",
            "request": "launch",
            "program": "${workspaceFolder}/src/strava_uploader/main.py",
            "justMyCode": true
          }
        ]
      }
    }
  }
}
